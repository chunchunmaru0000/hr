пусть __МИНУС: [ц8 2] = *"-",
пусть __ЧИСЛО_НА_ВЫВОД: [ц8 48] = [
	0,0,0,0, 0,0,0,0,	0,0,0,0, 0,0,0,0,
	0,0,0,0, 0,0,0,0,	0,0,0,0, 0,0,0,0,
	0,0,0,0, 0,0,0,0,	0,0,0,0, 0,0,0,0,
],
; ПОМНИТЬ: функция вывода числа должна идти перед выводом строки, потому что иначе
; при попытке вызвать вещать(0) вызовет вывод строки, с нул указателем
фц __АСМ вещать(число: ч64) тлен ( _асм "
	быть рбх рси
	проб рбх рбх
	идн0 __ВЫВОД_НЕ_0

	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48]
	быть байт(рси) \"0\"
	искл рсх рсх ++рсх
	идти __КОНЕЧНЫЙ_ВЫВОД_ЧИСЛА

__ВЫВОД_НЕ_0:
	иднз __ВЫВОД_БЕЗ_ЗНАКА

	искл еах еах ++еах ; еах = 1
	быть еди еах
	быть рси __МИНУС__[ц8_2]
	быть рдх еах ; длина минуса(1)
	сзов
	нег рбх

__ВЫВОД_БЕЗ_ЗНАКА:
	быть рах рбх ; число на вывод
	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48] + 48
	искл есх есх
	быть рди 10

	__ВЫВОД_ОДНОЙ_ЦИФРЫ:
		--рси
		++есх
		искл рдх рдх
		дел рди ; / 10

		плюс дл \"0\"
		быть (рси) дл
	проб рах рах
	идн0 __ВЫВОД_ОДНОЙ_ЦИФРЫ

__КОНЕЧНЫЙ_ВЫВОД_ЧИСЛА:
	искл еах еах ++еах	; еах = 1
	быть еди еах
						; рси уже где надо
	быть рдх рсх
	сзов
")

фц __АСМ вещать(число: ч64 длина_числа: ц32) тлен ( _асм "
	быть рбх рси
	быть е12 еди ; сохранить длину которая нужна
	искл е11 е11 ; минус или нет: 0 - нет, 1 - минус
	проб рбх рбх
	идн0 _2_ВЫВОД_НЕ_0

	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48]
	быть байт(рси) \"0\"
	искл рсх рсх ++рсх
	идти _2_КОНЕЧНЫЙ_ВЫВОД_ЧИСЛА

_2_ВЫВОД_НЕ_0:

	иднз _2_ВЫВОД_БЕЗ_ЗНАКА
		++е11
		нег рбх
_2_ВЫВОД_БЕЗ_ЗНАКА:

	быть рах рбх ; число на вывод
	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48] + 48
	искл есх есх
	быть рди 10

	_2_ВЫВОД_ОДНОЙ_ЦИФРЫ:
		--рси
		++есх
		искл рдх рдх
		дел рди ; / 10

		плюс дл \"0\"
		быть (рси) дл
	проб рах рах
	идн0 _2_ВЫВОД_ОДНОЙ_ЦИФРЫ

	проб е11 е11
	ид0 _2_ПРОПУСК_ВЫВОДА_ЗНАКА_ЕСЛИ_ОН_ЕСТЬ
		--рси
		++есх
		быть байт(рси) \"-\"
_2_ПРОПУСК_ВЫВОДА_ЗНАКА_ЕСЛИ_ОН_ЕСТЬ:

_2_КОНЕЧНЫЙ_ВЫВОД_ЧИСЛА:
	; здесь рси это там где надо __ЧИСЛО_НА_ВЫВОД__[ц8_48]
	; здесь рсх это длина строки выводимой
	; здесь е12 это нужная длина строки
	идти _2_СРАВНИТЬ_ПРОБЕЛ

	_2_ВЫВОД_ОДНОГО_ПРОБЕЛА:
		--рси
		++есх
		быть байт(рси) \" \"
_2_СРАВНИТЬ_ПРОБЕЛ:
	срав есх е12
	идм _2_ВЫВОД_ОДНОГО_ПРОБЕЛА

_2_ПРЯМ_КОНЕЧНЫЙ_ВЫВОД_ЧИСЛА:
	искл еах еах ++еах	; еах = 1
	быть еди еах
						; рси уже где надо
	быть рдх рсх
	сзов
")

пусть __ТОЧКА: [ц8 2] = *".",
пусть __ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ: ц32 = 6,

фц __АСМ вещать(вещ: в64) тлен ( _асм  "
	бытьэ рах э0
	быть рсх рах
	сдвп рсх 63
	проб сл сл ; сравнение старшего бита в double
	ид0 __НЕ_УБИРАТЬ_ЗНАК_ПРИ_ВЫВОДЕ_ВЕЩ
		сдвл рах 1 ; затирание
		сдвп рах 1 ; бита
		бытьэ э0 рах
		быть рси __МИНУС__[ц8_2]
		зов вещать__{ук_ц8_тлен}	; вывод минуса
	__НЕ_УБИРАТЬ_ЗНАК_ПРИ_ВЫВОДЕ_ВЕЩ:

	бытьэ э1 э0
	преосд2зч рси э0	; в рси целая часть
	пресч2сд э0 рси	; в э0  целая часть
	минссд э1 э0	; в э1  часть после запятой

	зов вещать__{ч64_тлен}		; вывод целой части
	быть рси __ТОЧКА__[ц8_2]
	зов вещать__{ук_ц8_тлен}	; вывод точки

	; чисел после запятой
	быть есх чбайт(__ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ__ц32)
	проб есх есх
	ид0 __ВЕЩАТЬ_ВЕЩ_БЕЗ_ВЫВОДА_ПОСЛЕ_ЗАПЯТОЙ
	; э0 = 10.0
	быть рах вбайт 10.0
	бытьэ э0 рах
	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48]

	__ВЕЩАТЬ_ВЕЩ_ЦИКЛ_ВЫВОД_ПОСЛЕ_ЗАПЯТОЙ:
		умнсд э1 э0
		преосд2зч ебх э1

		быть дл бл
		плюс дл \"0\"
		быть байт(рси) дл
		++рси

		пресч2сд э2 ебх
		минссд э1 э2
	--есх
	идн0 __ВЕЩАТЬ_ВЕЩ_ЦИКЛ_ВЫВОД_ПОСЛЕ_ЗАПЯТОЙ

	искл еах еах ++еах	; write(1)
	быть еди еах 		; stdout(1)
	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48]
	быть едх чбайт(__ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ__ц32)
	сзов

__ВЕЩАТЬ_ВЕЩ_БЕЗ_ВЫВОДА_ПОСЛЕ_ЗАПЯТОЙ:
")

фц __АСМ вещать(вещ: в64 чисел_после_запятой: ц32) тлен ( _асм "
	быть еах чбайт(__ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ__ц32)
	толк рах ; сохранить прошлое значение
	быть чбайт(__ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ__ц32) еси ; установить новое значение

	; вещ уже в э0
	зов вещать__{в64_тлен}

	выт рах
	быть чбайт(__ВЫВОДИТЬ_ЧИСЕЛ_ПОСЛЕ_ЗАПЯТОЙ__ц32) еах ; восстановить прошлое значение
")

фц __АСМ вещать_ноль() тлен ( "(ноль)" |> вещать )

фц __АСМ вещать(строка: стр) тлен ( _асм "
	проб рси рси
	ид0 вещать_ноль__{тлен}

	быть рди рси
	искл еах еах
	искл рсх рсх
	не рсх
	орф
	повтн0 осмсб
	быть рдх рди

	++еах 				; еах = write(1)
	быть еди еах	 	; еди = stdout(1)
						; рси строка
	минс рдх рси --едх	; длина строки
	сзов
")

фц __АСМ начертать(символ: ц8) тлен ( _асм "
	быть си ах
	быть байт(__ЧИСЛО_НА_ВЫВОД__[ц8_48]) ал

	искл еах еах ++еах
	быть еди еах
	быть рси __ЧИСЛО_НА_ВЫВОД__[ц8_48]
	быть рдх еах
	сзов
")
